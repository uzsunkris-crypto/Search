<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Billing — SEARCH</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body>
  <header class="topbar">
    <div class="brand">SEARCH</div>
    <div class="right">
      <a href="dashboard.html" class="ghost">Dashboard</a>
    </div>
  </header>

  <main style="padding:20px;max-width:720px;margin:88px auto 120px;">
    <section class="card">
      <h2 style="color:var(--neon);margin-bottom:6px">Billing</h2>
      <p class="muted">Daily access is ₦100 and lasts until midnight. Use the button below to pay for today.</p>

      <div style="margin-top:12px">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <div><strong>Daily Access</strong><div class="muted small">Valid for the current date</div></div>
          <div style="font-weight:900">₦100</div>
        </div>
        <div style="margin-top:12px">
          <a href="payment.html" class="primary full">Pay ₦100 for today</a>
        </div>
      </div>

      <div style="margin-top:14px">
        <h4 style="margin:0 0 8px;color:var(--neon)">Payment history</h4>
        <div id="payments-list" class="muted small">Loading…</div>
      </div>
    </section>
  </main>

<script>
  async function q(id){return document.getElementById(id)}
  document.addEventListener('DOMContentLoaded', async ()=>{
    if(window.FIREBASE_CLIENT_CONFIG && !firebase.apps.length) firebase.initializeApp(window.FIREBASE_CLIENT_CONFIG);
    if(window.firebase && firebase.auth){
      firebase.auth().onAuthStateChanged(async user=>{
        if(!user){ document.getElementById('payments-list').textContent='Sign in to view payments'; return; }
        try{
          const snap = await firebase.firestore().collection('payments').where('uid','==',user.uid).orderBy('ts','desc').limit(12).get();
          const list = [];
          snap.forEach(d=> {
            const p = d.data(); const date = p.ts && p.ts.toDate ? p.ts.toDate().toLocaleString() : '—';
            list.push(`<div style="padding:8px;border-radius:10px;background:rgba(0,0,0,0.18);margin-top:8px">${p.plan||'daily'} • ₦${p.amount} • ${p.status} • <div class="muted small">${date}</div></div>`);
          });
          document.getElementById('payments-list').innerHTML = list.length ? list.join('') : 'No payments found';
        }catch(e){ document.getElementById('payments-list').textContent='Failed to load payments'; }
      });
    } else {
      document.getElementById('payments-list').textContent = 'Firebase not configured';
    }
  });
</script>

  <footer class="footer muted">© SEARCH • Billing</footer>
</body>
</html>
