<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sign up — SEARCH</title>
  <link rel="stylesheet" href="styles.css"/>
</head>
<body class="auth-body">
  <main class="auth-card card" style="max-width:520px;margin:36px auto">
    <div style="text-align:center">
      <div class="brand-big" style="font-size:28px">SEARCH</div>
      <p class="muted">Create an account — verify email before payment.</p>
    </div>

    <div style="margin-top:12px">
      <label class="label">Full name</label>
      <input id="su-name" placeholder="e.g. Musa Ade" />
    </div>

    <div style="margin-top:12px">
      <label class="label">Email</label>
      <input id="su-email" type="email" placeholder="you@example.com" />
    </div>

    <div style="margin-top:12px">
      <label class="label">Password</label>
      <input id="su-pass" type="password" placeholder="Create a strong password" />
    </div>

    <div style="margin-top:12px">
      <label class="label">Confirm password</label>
      <input id="su-pass2" type="password" placeholder="Repeat password" />
    </div>

    <div style="margin-top:16px">
      <button id="create-account" class="primary full">Create account</button>
    </div>

    <div style="margin-top:12px;text-align:center">
      <a href="login.html" class="ghost small">Already have an account? Sign in</a>
    </div>

    <div id="verify-card" class="card" style="display:none;margin-top:16px">
      <div><strong>Verification email sent</strong></div>
      <div class="muted small" style="margin-top:8px">We sent a verification link to your email. Please verify it then press "I've verified".</div>
      <div style="margin-top:10px" class="row">
        <button id="i-verified" class="primary">I've verified</button>
        <button id="resend-email" class="ghost">Resend</button>
      </div>
    </div>
  </main>

<script>
  function q(id){return document.getElementById(id)}
  q('create-account').addEventListener('click', async ()=>{
    const name=q('su-name').value.trim(), email=q('su-email').value.trim();
    const pass=q('su-pass').value, pass2=q('su-pass2').value;
    if(!name||!email||!pass) return alert('Complete all fields');
    if(pass!==pass2) return alert('Passwords do not match');
    if(!window.FIREBASE_CLIENT_CONFIG) return alert('Add firebase-config.js');
    if(!firebase.apps.length) firebase.initializeApp(window.FIREBASE_CLIENT_CONFIG);
    try{
      const auth = firebase.auth();
      const res = await auth.createUserWithEmailAndPassword(email, pass);
      await res.user.updateProfile({ displayName: name });
      await res.user.sendEmailVerification();
      // write user doc
      const db = firebase.firestore();
      await db.collection('users').doc(res.user.uid).set({ name, email, created: firebase.firestore.FieldValue.serverTimestamp() }, { merge:true });
      q('verify-card').style.display='block';
      alert('Verification email sent. Check inbox/spam.');
    }catch(e){ alert(e.message||'Signup failed'); }
  });

  q('resend-email').addEventListener('click', async ()=>{
    if(!firebase.apps.length) firebase.initializeApp(window.FIREBASE_CLIENT_CONFIG);
    const user = firebase.auth().currentUser;
    if(!user) return alert('No user session');
    try{ await user.sendEmailVerification(); alert('Verification email resent'); } catch(e){ alert(e.message||'Failed to resend'); }
  });

  q('i-verified').addEventListener('click', async ()=>{
    if(!firebase.apps.length) firebase.initializeApp(window.FIREBASE_CLIENT_CONFIG);
    const user = firebase.auth().currentUser;
    if(!user) return alert('Sign in first');
    try{
      await user.reload();
      if(user.emailVerified) location.href='payment.html';
      else alert('Email not verified yet. Click the verification link we sent.');
    }catch(e){ alert(e.message||'Error'); }
  });
</script>
</body>
</html>
